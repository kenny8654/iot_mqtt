<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="http://static.pureexample.com/js/flot/excanvas.min.js"></script><![endif]-->
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.min.js"></script>
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.time.js"></script>
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.axislabels.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<!-- CSS -->
<style type="text/css">
    #flotcontainer {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    .row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -100px;
    }

    #flotcontainer2 {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    #flotcontainerallT {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    #flotcontainerallH {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    h1 {
        text-align: center;
        background-color: #FFF;
    }

    h3{
        color: #FFF;
    }

    input {
        text-align: center;
        background-color: #000;
    }

    #team {
        text-align: center;
        color: #FFF
    }

    #TH {
        text-align: center;
        color: #FFF;
    }

    body {
        background-image: url(./bg.png);
    }
</style>

<!-- Javascript -->
<script>
    var dataset;
    var totalPoints = 500;
    var updateInterval = 1000;
    var Humidity = [];
    var Temperature = [];
    var Humiditys = {};
    var Temperatures = {};
    var myTeamName = "Team1";

    function GetDatas() {
        get = $.ajax({
            url: "http://140.116.72.90:8080/getTeamsdata",
            type: "GET",
            success: function (txt) {
                $(document).ready(function () {
                    TeamsData = JSON.parse(txt)
                    for (var TeamName in TeamsData) {
                        // console.log("TeamName:"+TeamName)
                        TeamData = JSON.parse(TeamsData[TeamName])
                        // console.log("TeamData:"+TeamData)
                        Humidity = []
                        Temperature = []
                        TeamData.forEach((line) => {
			    if(+line[0]< Date.now()-780000){
			     // Humidity.push([+line[0], 0]);
		             // Temperature.push([+line[0], 0]);
			    }else{
                              Humidity.push([+line[0], +line[1]]);
                              Temperature.push([+line[0], +line[2]]);
			    }
                        })
                        Humidity.pop();
                        Temperature.pop();
                        Humiditys[TeamName] = Humidity;
                        Temperatures[TeamName] = Temperature;
                    }
                }
                );
            },
            error: function () {
              //  alert("ERROR!!!");
            }
        });
    }

    var options = {
        series: {
            lines: {
                show: true,
                lineWidth: 1.2,
                fill: true
            }
        },
        xaxis: {
            mode: "time",
            tickSize: [20, "second"],
            tickFormatter: function (v, axis) {
                var date = new Date(v);

                if (date.getSeconds() % 60 == 0 && date.getMinutes() % 2 == 0) {
                    var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                    var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                    var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                    return hours + ":" + minutes + ":" + seconds;
                } else {
                    return "";
                }
            },
            axisLabel: "Time",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 50,
            tickSize: 5,
            tickFormatter: function (v, axis) {
                if (v % 10 == 0) {
                    return v + "'C";
                } else {
                    return "";
                }
            },
            axisLabel: "Temperature",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 6
        },
        legend: {
            labelBoxBorderColor: "#fff"
        }
    };

    var optionsallT = {
        series: {
            lines: {
                show: true,
              //  lineWidth: 1.2,
             //   fill: true
            }
        },
        xaxis: {
            mode: "time",
            tickSize: [20, "second"],
            tickFormatter: function (v, axis) {
                var date = new Date(v);

                if (date.getSeconds() % 60 == 0 && date.getMinutes() % 2 == 0) {
                    var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                    var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                    var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                    return hours + ":" + minutes + ":" + seconds;
                } else {
                    return "";
                }
            },
            axisLabel: "Time",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 50,
            tickSize: 5,
            tickFormatter: function (v, axis) {
                if (v % 10 == 0) {
                    return v + "'C";
                } else {
                    return "";
                }
            },
            axisLabel: "Temperature",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 6
        },
        legend: {
            labelBoxBorderColor: "#fff"
        }
    };

    var options2 = {
        series: {
            lines: {
                show: true,
                lineWidth: 1.2,
                fill: true
            }
        },
        xaxis: {
            mode: "time",
            tickSize: [20, "second"],
            tickFormatter: function (v, axis) {
                var date = new Date(v);

                if (date.getSeconds() % 60 == 0 && date.getMinutes() % 2 == 0) {
                    var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                    var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                    var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                    return hours + ":" + minutes + ":" + seconds;
                } else {
                    return "";
                }
            },
            axisLabel: "Time",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 100,
            tickSize: 5,
            tickFormatter: function (v, axis) {
                if (v % 10 == 0) {
                    return v + "%";
                } else {
                    return "";
                }
            },
            axisLabel: "Humidity",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 6
        },
        legend: {
            labelBoxBorderColor: "#fff"
        }
    };
    var optionsallH = {
        series: {
            lines: {
                show: true,
                //lineWidth: 1.2,
                //fill: true,
                
            }
        },
        xaxis: {
            mode: "time",
            tickSize: [20, "second"],
            tickFormatter: function (v, axis) {
                var date = new Date(v);

                if (date.getSeconds() % 60 == 0 && date.getMinutes() % 2 == 0) {
                    var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                    var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                    var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                    return hours + ":" + minutes + ":" + seconds;
                } else {
                    return "";
                }
            },
            axisLabel: "Time",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 100,
            tickSize: 5,
            tickFormatter: function (v, axis) {
                if (v % 10 == 0) {
                    return v + "'%";
                } else {
                    return "";
                }
            },
            axisLabel: "Humidity",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        legend: {
            labelBoxBorderColor: "#fff"
        }
    };

    $(document).ready(function () {
        myTeamName = document.getElementById("TeamName").value;
        document.getElementById("display_teamName").innerHTML = myTeamName;
        GetDatas();
        dataset = [
            { label: "Temperature", data: Temperatures[myTeamName] }
        ];
        dataset2 = [
            { label: "Humidity", data: Humiditys[myTeamName] }
        ];
        datasetallT = []
        datasetallH = []
        try {
            for (TeamName of Temperatures) {
                datasetallT.push({ label: TeamName, data: Temperatures[TeamName] })
                datasetallH.push({ label: TeamName, data: Humiditys[TeamName] })
            }
        } catch (e) {
            console.log(e)
        }
        $.plot($("#flotcontainer"), dataset, options);
        $.plot($("#flotcontainer2"), dataset2, options2);
        $.plot($("#flotcontainerallT"), datasetallT, optionsallT);
        $.plot($("#flotcontainerallH"), datasetallH, optionsallH);

        function update() {
            myTeamName = document.getElementById("TeamName").value;
            document.getElementById("display_teamName").innerHTML = myTeamName;
            GetDatas();
            // console.log(Humidity);
            dataset = [
                { label: "Temperature", data: Temperatures[myTeamName] }
            ];
            dataset2 = [
       { label: "Humidity", data: Humiditys[myTeamName] }
            ];
            datasetallT = []
            datasetallH = []
            try {
                for (TeamName in Temperatures) {
                    datasetallT.push({ label: TeamName, data: Temperatures[TeamName] })
                    datasetallH.push({ label: TeamName, data: Humiditys[TeamName] })
                }
            } catch (e) {
                console.log(e)
            }

            try {
                length = Humiditys[myTeamName].length
                var t = String(Temperatures[myTeamName][length - 1][1]);
                var h = String(Humiditys[myTeamName][length - 1][1]);
                // console.log(typeof(h));
                document.getElementById("TH").innerHTML = "目前溫度  " + t + " 度C , 濕度  " + h + "%"
            } catch (e) { console.log(e); }
            $.plot($("#flotcontainer"), dataset, options)
            $.plot($("#flotcontainer2"), dataset2, options2)
            $.plot($("#flotcontainerallT"), datasetallT, optionsallT)
            $.plot($("#flotcontainerallH"), datasetallH, optionsallH)
            setTimeout(update, updateInterval);
        }

        update();
    });



</script>

<!-- HTML -->

<h1>MCSLAB</h1>
<h2 id="team">組名：
    <input type="text" id="TeamName" value="Team2"><br>
</h2>
<h2 id="TH">目前溫度 濕度 </h2>
<div class="container">
    <div class="row">
        <div class="col-md-5">
            <h3 id="display_teamName">Team</h3>
            <div id="flotcontainer"></div>
            <div id="flotcontainer2"></div>
        </div>
        <div class="col-md-2">
        </div>
        <div class="col-md-4">
            <h3>Each team</h3>
            <div id="flotcontainerallT"></div>
            <div id="flotcontainerallH"></div>
        </div>
    </div>
</div>
</div>
