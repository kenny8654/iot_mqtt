<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="http://static.pureexample.com/js/flot/excanvas.min.js"></script><![endif]-->
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.min.js"></script>
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.time.js"></script>
<script type="text/javascript" src="http://static.pureexample.com/js/flot/jquery.flot.axislabels.js"></script>

<!-- CSS -->
<style type="text/css">
    #flotcontainer {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    #flotcontainer2 {
        width: 600px;
        height: 200px;
        text-align: center;
        margin: 0 auto;
        background-color: #FFF;
    }

    h1 {
        text-align: center;
        background-color: #FFF;
    }
    
    #TH{
       text-align: center;        
       color: #FFF;
    }
    body {
        background-image: url(./bg.png);
    }
</style>

<!-- Javascript -->
<script>
    var data = [];
    data[0] = [];
    data[1] = [];
    var dataset;
    var totalPoints = 50;
    var updateInterval = 1000;
    // var Humidity = [];
    // var Temperature = [];

    function GetData() {
        get = $.ajax({
            url: "http://140.116.72.90:8080/getTxt",
            type: "GET",
            success: function (txt) {
                $(document).ready(function () {
                    lines = txt.split("\n")
                    // Humidity = []
                    // Temperature = []
                    // Humidity.length = 0
                    // Temperature.length = 0
                    data[0] = [];
                    data[1] = [];
                    lines.forEach(function (line) {
                        line = line.split(",")
                        // Humidity.push([+line[0], +line[1]]);
                        // Temperature.push([+line[0], +line[2]]);
                        data[0].push([+line[0], +line[1]]);
                        data[1].push([+line[0], +line[2]]);
                    })

                }
                );
                // Humidity.pop();
                // Temperature.pop();
                data[0].pop();
                data[1].pop();
                //console.log(data[0]);
                //console.log(data[1]);
            },
            error: function () {
                alert("ERROR!!!");
            }
        });
    }

    var options = {
        series: {
            lines: {
                show: true,
                lineWidth: 1.2,
                fill: true
            }
        },
        xaxis: {
            mode: "time",
            tickSize: [2, "second"],
            tickFormatter: function (v, axis) {
                var date = new Date(v);

                if (date.getSeconds() % 20 == 0) {
                    var hours = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                    var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                    var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                    return hours + ":" + minutes + ":" + seconds;
                } else {
                    return "";
                }
            },
            axisLabel: "Time",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 10
        },
        yaxis: {
            min: 0,
            max: 100,
            tickSize: 5,
            tickFormatter: function (v, axis) {
                if (v % 10 == 0) {
                    return v + "%('C)";
                } else {
                    return "";
                }
            },
            axisLabel: "T/H",
            axisLabelUseCanvas: true,
            axisLabelFontSizePixels: 12,
            axisLabelFontFamily: 'Verdana, Arial',
            axisLabelPadding: 6
        },
        legend: {
            labelBoxBorderColor: "#fff"
        }
    };

    $(document).ready(function () {
        GetData();
        console.log(data[0]);
        dataset = [
            { label: "Humidity", data: data[0] },
            { label: "Temperature", data: data[1] }
        ];

        $.plot($("#flotcontainer"), dataset, options);
        $.plot($("#flotcontainer2"), dataset, options);

        function update() {
            GetData();
            console.log(data[0]);
            dataset = [           
                { label: "Humidity", data: data[0] },           
                { label: "Temperature", data: data[1]}       
            ];
            var t = String(data[1][49]).split(',');
            var h = String(data[0][49]).split(',');
            console.log(typeof(h));               
            document.getElementById("TH").innerHTML = "目前溫度  " + t[1] + " 度C , 濕度  " + h[1] + "%"
            $.plot($("#flotcontainer"), dataset, options)
            $.plot($("#flotcontainer2"), dataset, options)
            setTimeout(update, updateInterval);
        }

        update();
    });



</script>

<!-- HTML -->

<h1>MCSLAB</h1>
<h2 id="TH">目前溫度 濕度 </h2>
<div id="flotcontainer"></div>
<div id="flotcontainer2"></div>
